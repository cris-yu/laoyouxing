<scroll-view scroll-y class="product-detail">
  <!-- å°é¢å›¾ -->
  <image class="cover-image" src="{{product.coverImage}}" mode="aspectFill"></image>

  <!-- åŸºæœ¬ä¿¡æ¯ -->
  <view class="product-header card">
    <text class="product-name">{{product.name}}</text>
    <view class="product-tags">
      <text class="tag tag-primary" wx:for="{{product.tags}}" wx:key="index">{{item}}</text>
    </view>
    <view class="product-meta">
      <text class="meta-item">{{product.days}}å¤©</text>
      <text class="meta-divider">|</text>
      <text class="meta-item">{{product.departureCity}} - {{product.destinationCity}}</text>
    </view>
    <view class="price-info">
      <view class="price">
        <text class="price-label">èµ·ä»·</text>
        <text class="price-value">Â¥{{product.priceFrom}}</text>
      </view>
    </view>
  </view>

  <!-- é€‚è€åŒ–æ ‡ç­¾ -->
  <view class="elderly-info card">
    <view class="section-title">é€‚è€åŒ–ä¿¡æ¯</view>
    <view class="info-item">
      <text class="info-label">é€‚åˆå¹´é¾„ï¼š</text>
      <text class="info-value">{{product.ageRange}}å²</text>
    </view>
    <view class="info-item">
      <text class="info-label">è¡Œç¨‹å¼ºåº¦ï¼š</text>
      <text class="info-value">{{product.intensity === 'low' ? 'è½»æ¾' : product.intensity === 'medium' ? 'é€‚ä¸­' : 'è¾ƒé«˜'}}</text>
      <text class="info-desc">ï¼ˆ{{product.intensityDescription}}ï¼‰</text>
    </view>
    <view class="info-item">
      <text class="info-label">åŒ»ç–—é…ç½®ï¼š</text>
      <text class="info-value">{{product.medicalLevel === 'near_clinic' ? 'ä¸´è¿‘è¯Šæ‰€' : product.medicalLevel === 'near_hospital' ? 'ä¸´è¿‘åŒ»é™¢' : 'åŸºç¡€é…ç½®'}}</text>
      <text class="info-desc">ï¼ˆ{{product.medicalDescription}}ï¼‰</text>
    </view>
    <view class="info-item">
      <text class="info-label">æœ€é•¿è½¦ç¨‹ï¼š</text>
      <text class="info-value">{{product.maxSingleRideHours}}å°æ—¶</text>
    </view>
  </view>

  <!-- è¡Œç¨‹å®‰æ’ -->
  <view class="itinerary card">
    <view class="section-title">è¡Œç¨‹å®‰æ’</view>
    <view class="day-item" wx:for="{{product.itinerary}}" wx:key="dayIndex">
      <view class="day-header">
        <text class="day-number">ç¬¬{{item.dayIndex}}å¤©</text>
        <text class="day-title">{{item.title}}</text>
      </view>
      <view class="segment-item" wx:for="{{item.schedule}}" wx:key="id" wx:for-item="segment">
        <view class="segment-time">{{segment.time}}</view>
        <view class="segment-content">
          <text class="segment-title">{{segment.title}}</text>
          <text class="segment-desc">{{segment.description}}</text>
          <text class="segment-tag" wx:if="{{segment.hasAudioGuide}}">ğŸ§ æœ‰è®²è§£</text>
        </view>
      </view>
    </view>
  </view>

  <!-- è´¹ç”¨è¯´æ˜ -->
  <view class="fee-info card">
    <view class="section-title">è´¹ç”¨è¯´æ˜</view>
    <view class="fee-section">
      <text class="fee-label">è´¹ç”¨åŒ…å«ï¼š</text>
      <view class="fee-list">
        <text class="fee-item" wx:for="{{product.included}}" wx:key="index">â€¢ {{item}}</text>
      </view>
    </view>
    <view class="fee-section">
      <text class="fee-label">è´¹ç”¨ä¸å«ï¼š</text>
      <view class="fee-list">
        <text class="fee-item" wx:for="{{product.excluded}}" wx:key="index">â€¢ {{item}}</text>
      </view>
    </view>
  </view>

  <!-- AI è¡Œç¨‹é¡¾é—® -->
  <view class="ai-advisor card" wx:if="{{hasFamily}}">
    <view class="section-title">ğŸ¤– AI è¡Œç¨‹é¡¾é—®</view>
    <text class="advisor-desc">è®© AI è¯„ä¼°è¿™æ¡çº¿è·¯æ˜¯å¦é€‚åˆæ‚¨çš„å®¶äºº</text>
    <button class="btn btn-secondary" bindtap="askAI">é—®é—® AI æ˜¯å¦é€‚åˆæˆ‘çˆ¸å¦ˆ</button>
  </view>

  <!-- åº•éƒ¨æ“ä½œæ  -->
  <view class="bottom-bar">
    <view class="price-summary">
      <text class="price-label">èµ·</text>
      <text class="price-value">Â¥{{product.priceFrom}}</text>
    </view>
    <button class="btn btn-primary btn-book" bindtap="goToConfirm">ç«‹å³é¢„è®¢</button>
  </view>
</scroll-view>

<!-- AI å»ºè®®å¼¹çª— -->
<view class="modal-overlay" wx:if="{{showAIModal}}" bindtap="closeAIModal">
  <view class="modal-content" catchtap="stopPropagation">
    <view class="modal-header">
      <text class="modal-title">AI é€‚é…å»ºè®®</text>
      <icon type="cancel" size="20" bindtap="closeAIModal"></icon>
    </view>
    <view class="modal-body">
      <view class="ai-result">
        <text class="ai-headline">{{aiResult.headline}}</text>
        <view class="ai-details">
          <text class="ai-detail-item" wx:for="{{aiResult.details}}" wx:key="index">â€¢ {{item}}</text>
        </view>
        <view class="ai-advice">
          <text class="advice-label">å»ºè®®ï¼š</text>
          <text class="advice-text">{{aiResult.adviceForChild}}</text>
        </view>
      </view>
    </view>
    <view class="modal-footer">
      <button class="btn btn-primary" bindtap="closeAIModal">çŸ¥é“äº†</button>
    </view>
  </view>
</view>
